<!DOCTYPE html>
<html lang="en">
<head>
  <!-- <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
  <title>text editor</title>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
</head>
<body onload="enableEditMode();" style="width: 1000px;">
  <div>
    <button onclick="execCmd('bold');"><i class="fas fa-bold"></i></button>
    <button onclick="execCmd('italic');"><i class="fas fa-italic"></i></button>
    <button onclick="execCmd('underline');"><i class="fas fa-underline"></i></button>
    <button onclick="execCmd('strikeThrough');"><i class="fas fa-strikethrough"></i></button>
    <button onclick="execCmd('justifyLeft');"><i class="fas fa-align-left"></i></button>
    <button onclick="execCmd('justifyCenter');"><i class="fas fa-align-center"></i></button>
    <button onclick="execCmd('justifyRight');"><i class="fas fa-align-right"></i></button>
    <button onclick="execCmd('justifyFull');"><i class="fas fa-align-justify"></i></button>
    <button onclick="execCmd('cut');"><i class="fas fa-cut"></i></button>
    <button onclick="execCmd('copy');"><i class="fas fa-copy"></i></button>
    <button onclick="execCmd('indent');"><i class="fas fa-indent"></i></button>
    <button onclick="execCmd('outdent');"><i class="fas fa-outdent"></i></button>
    <button onclick="execCmd('subscript');"><i class="fas fa-subscript"></i></button>
    <button onclick="execCmd('superscript');"><i class="fas fa-superscript"></i></button>
    <button onclick="execCmd('undo');"><i class="fas fa-undo"></i></button>
    <button onclick="execCmd('redo');"><i class="fas fa-redo"></i></button>
    <button onclick="execCmd('insertUnorderedList');"><i class="fas fa-list-ul"></i></button>
    <button onclick="execCmd('insertOrderedList');"><i class="fas fa-list-ol"></i></button>
    <button onclick="execCmd('insertParagraph');"><i class="fas fa-paragraph"></i></button>
    <select onchange="execCommandWithArg('formatBlock', this.value);">
      <option value="H1">H1</option>
      <option value="H2">H2</option>
      <option value="H3">H3</option>
      <option value="H4">H4</option>
      <option value="H5">H5</option>
      <option value="H6">H6</option>
    </select>
    <button onclick="execCmd('insertHorizontalRule');">HR</button>
    <button onclick="execCommandWithArg('createLink', prompt('Enter a URL', ''));"><i class="fas fa-link"></i></button>
    <button onclick="execCmd('unlink');"><i class="fas fa-unlink"></i></button>
    <button onclick="toggleSource();"><i class="fas fa-code"></i></button>
    <button onclick="toggleEdit();">Toggle Edit</button>
    <select onchange="execCommandWithArg('fontName', this.value);">
      <option value="Arial">Arial</option>
      <option value="Comic Sans MS">Comic Sans MS</option>
      <option value="Courier">Courier</option>
      <option value="Georgia">Georgia</option>
      <option value="Tahoma">Tahoma</option>
      <option value="Times New Roman">Times New Roman</option>
      <option value="Verdana">Verdana</option>
    </select>
    <select onchange="execCommandWithArg('fontSize', this.value);">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
    </select>
    Fore Color: <input type="color" onchange="execCommandWithArg('foreColor', this.value);"/>
    Background Color: <input type="color" onchange="execCommandWithArg('hiliteColor', this.value);"/>
    <button onclick="execCommandWithArg('insertImage', prompt('Enter the image URL', ''));"><i class="fas fa-file-image"></i></button>
    <button onclick="execCmd('selectAll');">Select All</button>
    <button onclick="exportToPDF();">PDF</button>
    <button onclick="exportToWord();">Word</button>

  </div>
  <iframe id="test" name="richTextField" style="width: 1000px; height: 500px;"></iframe>
  <script type="text/javascript">

    var showingSourceCode = false;
    var isInEditMode = true;

    function enableEditMode() {
      richTextField.document.designMode = 'On';
    }

    function execCmd(command) {
      richTextField.document.execCommand(command, false, null);
    }

    function execCommandWithArg(command, arg) {
      richTextField.document.execCommand(command, false, arg);
    }

    function toggleSource() {
      if (showingSourceCode) {
        richTextField.document.getElementsByTagName('body')[0].innerHTML = richTextField.document.getElementsByTagName('body')[0].textContent;
        showingSourceCode = false;
      } else {
        richTextField.document.getElementsByTagName('body')[0].textContent = richTextField.document.getElementsByTagName('body')[0].innerHTML;
        showingSourceCode = true;
      }
    }

    function toggleEdit() {
      if (isInEditMode) {
        richTextField.document.designMode = 'Off';
        isInEditMode = false;
      } else {
        richTextField.document.designMode = 'On';
        isInEditMode = true;
      }
    }

    function exportToPDF() {
      
      html2canvas(richTextField.document.getElementsByTagName('body')[0], {
        onrendered: function (canvas) {

            // 캔버스를 이미지로 변환
            var imgData = canvas.toDataURL('image/png');

            var imgWidth = 190; // 이미지 가로 길이(mm) A4 기준
            var pageHeight = imgWidth * 1.414;  // 출력 페이지 세로 길이 계산 A4 기준
            var imgHeight = canvas.height * imgWidth / canvas.width;
            var heightLeft = imgHeight;

            var doc = new jsPDF();
            var position = 10;

            // 첫 페이지 출력
            doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;

            // 한 페이지 이상일 경우 루프 돌면서 출력
            while (heightLeft >= 20) {
                position = heightLeft - imgHeight;
                doc.addPage();
                doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }

            // 파일 저장
            doc.save('sample.pdf');


            //이미지로 표현
            //document.write('<img src="'+imgData+'" />');
        }
          
      });
        

    }

    function exportToWord(){
        var html = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export HTML To Doc</title></head><body>";
        var footer = "</body></html>";
        var html = html+richTextField.document.getElementsByTagName('body')[0].innerHTML+footer;
    
        
        //link url
        var url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(html);
        
        //file name
        filename = 'sample_A4'+'.doc';
        
        // Creates the  download link element dynamically
        var downloadLink = document.createElement("a");
    
        document.body.appendChild(downloadLink);
        
        //Link to the file
        downloadLink.href = url;
            
        //Setting up file name
        downloadLink.download = filename;
            
        //triggering the function
        downloadLink.click();
        //Remove the a tag after donwload starts.
        document.body.removeChild(downloadLink);
    }
  </script>
</body>
</html>